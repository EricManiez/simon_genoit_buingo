import csv
import random
from sys import stdout
from typing import List, Tuple, Iterator

from jinja2 import Template

GRID_WIDTH = 5


def export_table_to_html(grid_values: Iterator[Tuple[str, str]]) -> str:
    """
    Export grid values to grid.html file
    """
    with open('template.html') as file_:
        template = Template(file_.read())
    with open("index.html", "w") as file:
        html = template.render(values=grid_values, width=GRID_WIDTH)
        file.write(html)
    return html


def get_table_ids():
    ids: List[str] = []
    alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    for x in range(GRID_WIDTH):
        letter = alphabet[x]
        for y in range(GRID_WIDTH):
            ids.append(letter + str(y + 1))
    return ids


def get_random_entries(entries: List[str], sub_entries_size=GRID_WIDTH ** 2) -> List[str]:
    """
    Get a randomized sublist of a provided string list.
    :param entries: collection to filter and randomize
    :param sub_entries_size: how many to keep
    :return:
    """
    random.seed()
    sample = random.sample(entries, sub_entries_size)
    sample[sub_entries_size // 2] = "X"
    return sample


def import_entries() -> List[str]:
    """
    Import the entries from grid_entries.csv into a list of strings.
    :return: list of string containing entries.
    """
    entries = []
    with open("grid_entries.csv") as csvfile:
        for row in csv.reader(csvfile):
            for entry in row:
                entries.append(entry)
        return entries


def main():
    entries = import_entries()
    sub_entries = get_random_entries(entries)
    html = export_table_to_html(zip(get_table_ids(), sub_entries))
    stdout.write(html)


if __name__ == "__main__":
    # execute only if run as a script
    main()
